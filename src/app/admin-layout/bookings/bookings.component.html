<div class="bookings-container">
  <!-- Page Header -->
  <div class="page-header">
    <h2 class="page-title">Bookings Management</h2>
    <p class="page-description">Manage tour bookings and customer details</p>
  </div>

  <!-- Controls Section -->
  <div class="controls-section">
    <div class="search-bar">
      <i class="fas fa-search search-icon"></i>
      <input
        class="search-input"
        type="text"
        placeholder="Search by name, email, or tour ID"
        [(ngModel)]="searchTerm"
        (input)="onSearch()" />
    </div>
     <div class="action-buttons">
            <button class="btn btn-refresh" (click)="refreshBookings()">
                <i class="fas fa-sync-alt"></i>
                Refresh
            </button>
            <button class="btn btn-primary" (click)="exportBookings()">
                <i class="fas fa-download"></i>
                Export
            </button>
        </div>
  </div>

  <!-- Table Container -->
  <div class="table-container">
    <div class="table-header">
      <div class="table-title">
        <i class="fas fa-calendar-check"></i> Bookings List
      </div>
      <div class="table-actions">
        <select class="sort-select" [(ngModel)]="sortBy" (change)="toggleSortOrder()">
          <option value="name">Sort by Name</option>
          <option value="travel_date">Sort by Travel Date</option>
        </select>
      </div>
    </div>

    <div class="table-wrapper">
      <table class="bookings-table">
        <thead>
          <tr>
            <th class="col-serial">#</th>
            <th class="col-name">Name</th>
            <th class="col-email">Email</th>
            <th class="col-travel-date">Travel Date</th>
            <th class="col-tour-id">Tour ID</th>
            <th class="col-actions">Actions</th>
          </tr>
        </thead>
        <tbody>
          <ng-container *ngFor="let booking of paginatedBookings; let i = index; trackBy: trackByBookingId">
            <tr class="booking-row" [class.deleting]="booking.isDeleting">
              <td class="col-serial">
                <div class="serial-number">{{ getSerialNumber(i) }}</div>
              </td>
              <td class="col-name">
                <div class="name-cell">
                  <div class="user-avatar">{{ booking.name.charAt(0).toUpperCase() }}</div>
                  <div class="name-text">{{ booking.name }}</div>
                </div>
              </td>
              <td class="col-email">
                <span class="email-text">{{ booking.email }}</span>
              </td>
              <td class="col-travel-date">
                <span class="date-text">{{ formatDate(booking.travel_date) }}</span>
              </td>
              <td class="col-tour-id">
                <span class="tour-id-text">{{ booking.tour_id }}</span>
              </td>
              <td class="col-actions">
                <button class="btn btn-sm expand-btn" (click)="toggleExpanded(booking)">
                  <i class="fas" [class.fa-chevron-down]="!booking.isExpanded" [class.fa-chevron-up]="booking.isExpanded"></i>
                </button>
                <button class="btn btn-sm btn-danger delete-btn" (click)="deleteBooking(booking)" [disabled]="booking.isDeleting">
                  <i class="fas fa-spinner fa-spin" *ngIf="booking.isDeleting"></i>
                  <i class="fas fa-trash" *ngIf="!booking.isDeleting"></i>
                </button>
              </td>
            </tr>
            <tr *ngIf="booking.isExpanded" class="details-row">
              <td colspan="6">
                <div class="details-content">
                  <div class="details-grid">
                    <div class="detail-item"><span class="detail-label">Phone:</span> <span class="detail-value">{{ booking.phone || 'Not provided' }}</span></div>
                    <div class="detail-item"><span class="detail-label">Days:</span> <span class="detail-value">{{ booking.days || 'Not specified' }}</span></div>
                    <div class="detail-item"><span class="detail-label">Adults:</span> <span class="detail-value">{{ booking.adults }}</span></div>
                    <div class="detail-item"><span class="detail-label">Children:</span> <span class="detail-value">{{ booking.children }}</span></div>
                    <div class="detail-item"><span class="detail-label">Child Ages:</span> <span class="detail-value">{{ booking.child_ages?.join(', ') || 'None' }}</span></div>
                    <div class="detail-item"><span class="detail-label">Hotel Rating:</span> <span class="detail-value">{{ booking.hotel_rating || 'Not specified' }}</span></div>
                    <div class="detail-item"><span class="detail-label">Meal Plan:</span> <span class="detail-value">{{ booking.meal_plan || 'Not specified' }}</span></div>
                    <div class="detail-item"><span class="detail-label">Flight Option:</span> <span class="detail-value">{{ booking.flight_option || 'Not specified' }}</span></div>
                    <div class="detail-item" *ngIf="booking.flight_option === 'with-flight'"><span class="detail-label">Flight Number:</span> <span class="detail-value">{{ booking.flight_number }}</span></div>
                    <div class="detail-item"><span class="detail-label">Created At:</span> <span class="detail-value">{{ formatDate(booking.created_at) }} {{ formatTime(booking.created_at) }}</span></div>
                  </div>
                </div>
              </td>
            </tr>
          </ng-container>
        </tbody>
      </table>
    </div>

    <div class="no-bookings" *ngIf="filteredBookings.length === 0">
      <div class="no-bookings-icon"><i class="fas fa-info-circle"></i></div>
      <h3>No bookings found</h3>
      <p>Try adjusting your search or filters.</p>
      <button class="btn btn-secondary" *ngIf="searchTerm" (click)="clearSearch()">Clear Search</button>
    </div>

    <div class="pagination-container" *ngIf="filteredBookings.length > pageSize">
      <div class="pagination-info">Page {{ currentPage }} of {{ getTotalPages() }}</div>
      <div class="pagination-controls">
        <button class="btn btn-sm pagination-btn" (click)="previousPage()" [disabled]="currentPage === 1">Prev</button>
        <div class="page-numbers">
          <button
            *ngFor="let page of getPageNumbers()"
            class="btn btn-sm page-btn"
            [class.active]="page === currentPage"
            (click)="goToPage(page)">{{ page }}</button>
        </div>
        <button class="btn btn-sm pagination-btn" (click)="nextPage()" [disabled]="currentPage === getTotalPages()">Next</button>
      </div>
    </div>
  </div>

  <!-- Delete Modal -->
  <div class="modal-overlay" *ngIf="showDeleteModal" (click)="cancelDelete()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirm Deletion</h3>
        <button class="modal-close" (click)="cancelDelete()"><i class="fas fa-times"></i></button>
      </div>
      <div class="modal-body">
        <div class="warning-icon"><i class="fas fa-exclamation-triangle"></i></div>
        <p>Are you sure you want to delete booking for:</p>
        <strong>{{ bookingToDelete?.name }}</strong>
        <p class="booking-details">{{ bookingToDelete?.email }} (Tour ID: {{ bookingToDelete?.tour_id }})</p>
        <div class="warning-text">This action cannot be undone.</div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" (click)="confirmDelete()">Yes, Delete</button>
        <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
      </div>
    </div>
  </div>
</div>
